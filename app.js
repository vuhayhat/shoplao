const translations = {
  vi: {
    home: {
      title: "ChÃ o má»«ng Ä‘áº¿n vá»›i ThÆ°Æ¡ng Máº¡i Äiá»‡n Tá»­ Äa Quá»‘c Gia!",
      desc: `Dá»± Ã¡n há»— trá»£ Ä‘a ngÃ´n ngá»¯, AI phÃ¢n tÃ­ch sáº£n pháº©m, quáº£n lÃ½ shop cÃ¡ nhÃ¢n, thanh toÃ¡n linh hoáº¡t vÃ  nhiá»u tÃ­nh nÄƒng hiá»‡n Ä‘áº¡i.`
    },
    shop: {
      title: "Trang cÃ¡ nhÃ¢n Shop",
      desc: "Xem thÃ´ng tin shop, sáº£n pháº©m, Ä‘Ã¡nh giÃ¡ vÃ  chia sáº» máº¡ng xÃ£ há»™i."
    },
    register: {
      title: "ÄÄƒng kÃ½ má»Ÿ Shop",
      desc: "Táº¡o tÃ i khoáº£n, Ä‘Äƒng kÃ½ shop, chá» duyá»‡t vÃ  quáº£n lÃ½ cá»­a hÃ ng riÃªng."
    },
    products: {
      title: "Quáº£n lÃ½ Sáº£n pháº©m",
      desc: "ThÃªm, sá»­a, xoÃ¡ sáº£n pháº©m, mÃ´ táº£ Ä‘a ngÃ´n ngá»¯, chá»‰nh sá»­a áº£nh báº±ng AI."
    },
    cart: {
      title: "Giá» hÃ ng & Thanh toÃ¡n",
      desc: "Há»— trá»£ nhiá»u phÆ°Æ¡ng thá»©c thanh toÃ¡n, theo dÃµi Ä‘Æ¡n hÃ ng, giao hÃ ng."
    },
    ai: {
      title: "PhÃ¢n tÃ­ch sáº£n pháº©m báº±ng AI",
      desc: "AI táº¡o mÃ´ táº£, gá»£i Ã½ tá»« khoÃ¡ SEO, phÃ¢n tÃ­ch áº£nh, cháº¥m Ä‘iá»ƒm sáº£n pháº©m."
    },
    statistic: {
      title: "Thá»‘ng kÃª tá»•ng quan",
      desc: "Xem tá»•ng sá»‘ Ä‘Æ¡n, sáº£n pháº©m Ä‘Ã£ bÃ¡n, thu nháº­p, khÃ¡ch hÃ ng vÃ  sáº£n pháº©m bÃ¡n cháº¡y."
    },
    fbpost: {
      title: "ÄÄƒng bÃ i Facebook tá»± Ä‘á»™ng",
      desc: "Táº¡o ná»™i dung quáº£ng bÃ¡ sáº£n pháº©m vÃ  hÆ°á»›ng dáº«n Ä‘Äƒng Facebook."
    }
  },
  en: {
    home: {
      title: "Welcome to the Multi-National E-Commerce Platform!",
      desc: `The project supports multi-language, AI product analysis, personal shop management, flexible payment, and more modern features.`
    },
    shop: {
      title: "Personal Shop Page",
      desc: "View shop info, products, ratings, and social sharing."
    },
    register: {
      title: "Register a Shop",
      desc: "Create an account, register a shop, wait for approval, and manage your store."
    },
    products: {
      title: "Product Management",
      desc: "Add, edit, delete products, multilingual descriptions, AI image editing."
    },
    cart: {
      title: "Cart & Payment",
      desc: "Support multiple payment methods, order tracking, delivery."
    },
    ai: {
      title: "AI Product Analysis",
      desc: "AI generates descriptions, SEO keyword suggestions, image analysis, product scoring."
    },
    statistic: {
      title: "Statistics Overview",
      desc: "View total orders, sold products, income, customers, and best-selling products."
    },
    fbpost: {
      title: "Auto Facebook Post",
      desc: "Generate product promotion content and Facebook posting guide."
    }
  },
  lo: {
    home: {
      title: "àºàº´àº™àº”àºµàº•à»‰àº­àº™àº®àº±àºšàºªàº¹à»ˆà»àºàº¥àº”àºŸàº­àº¡àºàº²àº™àº´àº”àº­àº´àº™à»€àº•àºµà»€àº™àº±àº”àº«àº¼àº²àºàºŠàº²àº”!",
      desc: `à»‚àº„àº‡àºàº²àº™àº®àº­àº‡àº®àº±àºšàº«àº¼àº²àºàºàº²àºªàº², AI àº§àº´à»€àº„àº²àº°àºªàº´àº™àº„à»‰àº², àºšà»àº¥àº´àº«àº²àº™àº®à»‰àº²àº™àºªà»ˆàº§àº™àº•àº»àº§, àºàº²àº™àºˆà»ˆàº²àºà»€àº‡àº´àº™àº«àº¼àº²àºàº®àº¹àºšà»àºšàºš à»àº¥àº°àº­àº·à»ˆàº™à»†.`
    },
    shop: {
      title: "à»œà»‰àº²àº®à»‰àº²àº™àºªà»ˆàº§àº™àº•àº»àº§",
      desc: "à»€àºšàº´à»ˆàº‡àº‚à»à»‰àº¡àº¹àº™àº®à»‰àº²àº™, àºªàº´àº™àº„à»‰àº², àºàº²àº™àº›àº°à»€àº¡àºµàº™, à»àº¥àº°àºàº²àº™à»àºšà»ˆàº‡àº›àº±àº™àºªàº·à»ˆàºªàº±àº‡àº„àº»àº¡."
    },
    register: {
      title: "àº¥àº»àº‡àº—àº°àºšàº½àº™à»€àº›àºµàº”àº®à»‰àº²àº™",
      desc: "àºªà»‰àº²àº‡àºšàº±àº™àºŠàºµ, àº¥àº»àº‡àº—àº°àºšàº½àº™àº®à»‰àº²àº™, àº¥à»àº–à»‰àº²àº­àº°àº™àº¸àº¡àº±àº”, à»àº¥àº°àºšà»àº¥àº´àº«àº²àº™àº®à»‰àº²àº™."
    },
    products: {
      title: "àºàº²àº™àºˆàº±àº”àºàº²àº™àºªàº´àº™àº„à»‰àº²",
      desc: "à»€àºàºµà»ˆàº¡, à»àºà»‰à»„àº‚, àº¥àº¶àºšàºªàº´àº™àº„à»‰àº², àº„àº³àº­àº°àº—àº´àºšàº²àºàº«àº¼àº²àºàºàº²àºªàº², à»àºà»‰à»„àº‚àº®àº¹àºšàºàº²àºš AI."
    },
    cart: {
      title: "àºàº°àº•à»ˆàº² & àºàº²àº™àºˆà»ˆàº²àºà»€àº‡àº´àº™",
      desc: "àº®àº­àº‡àº®àº±àºšàº§àº´àº—àºµàºˆà»ˆàº²àºà»€àº‡àº´àº™àº«àº¼àº²àºàº®àº¹àºšà»àºšàºš, àº•àº´àº”àº•àº²àº¡àº„àº³àºªàº±à»ˆàº‡, àºàº²àº™àºˆàº±àº”àºªàº»à»ˆàº‡."
    },
    ai: {
      title: "AI àº§àº´à»€àº„àº²àº°àºªàº´àº™àº„à»‰àº²",
      desc: "AI àºªà»‰àº²àº‡àº„àº³àº­àº°àº—àº´àºšàº²àº, à»àº™àº°àº™àº³àº„àº³àºªàº³àº„àº±àº™ SEO, àº§àº´à»€àº„àº²àº°àº®àº¹àºš, àº›àº°à»€àº¡àºµàº™àºªàº´àº™àº„à»‰àº²."
    },
    statistic: {
      title: "àºªàº°àº–àº´àº•àº´àºàº²àºšàº¥àº§àº¡",
      desc: "à»€àºšàº´à»ˆàº‡àºˆàº³àº™àº§àº™àº„àº³àºªàº±à»ˆàº‡, àºªàº´àº™àº„à»‰àº²àº—àºµà»ˆàº‚àº²àºà»„àº”à»‰, àº¥àº²àºàº®àº±àºš, àº¥àº¹àºàº„à»‰àº² à»àº¥àº°àºªàº´àº™àº„à»‰àº²àº‚àº²àºàº”àºµ."
    },
    fbpost: {
      title: "à»‚àºàºªàº•à»Œà»€àºŸàºªàºšàº¸àºàº­àº±àº”àº•àº°à»‚àº™àº¡àº±àº”",
      desc: "àºªà»‰àº²àº‡à»€àº™àº·à»‰àº­àº«àº²à»‚àº„àºªàº°àº™àº²àºªàº´àº™àº„à»‰àº² à»àº¥àº° à»àº™àº°àº™àº³àºàº²àº™à»‚àºàºªàº•à»Œà»€àºŸàºªàºšàº¸àº."
    }
  }
};

let demoCategories = [
  { name: "Thá»i trang", count: 2 },
  { name: "GiÃ y dÃ©p", count: 1 },
  { name: "Phá»¥ kiá»‡n", count: 0 }
];
let demoProducts = [
  {
    name: "Ão thun nam basic",
    img: "https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=400&q=80",
    price: 199000,
    status: "Äang bÃ¡n",
    category: "Thá»i trang",
    desc: "Ão thun cotton thoÃ¡ng mÃ¡t, form tráº» trung, dá»… phá»‘i Ä‘á»“, phÃ¹ há»£p má»i hoáº¡t Ä‘á»™ng."
  },
  {
    name: "Quáº§n jeans ná»¯",
    img: "https://images.unsplash.com/photo-1516762689617-f5e6b9cfd2c1?auto=format&fit=crop&w=400&q=80",
    price: 299000,
    status: "Háº¿t hÃ ng",
    category: "Thá»i trang",
    desc: "Quáº§n jeans ná»¯ co giÃ£n, tÃ´n dÃ¡ng, cháº¥t váº£i bá»n Ä‘áº¹p, phÃ¹ há»£p má»i phong cÃ¡ch."
  },
  {
    name: "GiÃ y sneaker tráº¯ng",
    img: "https://images.unsplash.com/photo-1519741497674-611481863552?auto=format&fit=crop&w=400&q=80",
    price: 499000,
    status: "Äang bÃ¡n",
    category: "GiÃ y dÃ©p",
    desc: "Sneaker tráº¯ng tráº» trung, nháº¹, khÃ´ng tháº¥m nÆ°á»›c, dá»… phá»‘i Ä‘á»“, hot trend nÄƒm nay."
  }
];

// ThÃªm dá»¯ liá»‡u Ä‘Æ¡n hÃ ng máº«u
const demoOrders = [
  {
    id: 1,
    customer: 'Nguyá»…n VÄƒn A',
    items: [0, 2], // index sáº£n pháº©m
    total: 199000 + 499000,
    status: 'ÄÃ£ thanh toÃ¡n',
    date: '2024-06-01'
  },
  {
    id: 2,
    customer: 'Tráº§n Thá»‹ B',
    items: [1],
    total: 299000,
    status: 'Chá» thanh toÃ¡n',
    date: '2024-06-02'
  }
];

let cart = [];

let currentLang = localStorage.getItem('lang') || navigator.language.slice(0,2) || 'vi';
if (!['vi','en','lo'].includes(currentLang)) currentLang = 'vi';

function setLang(lang) {
  currentLang = lang;
  localStorage.setItem('lang', lang);
  renderPage(currentPage);
}

let currentPage = 'home';

function navigate(page) {
  currentPage = page;
  renderPage(page);
}

function renderPage(page) {
  const t = translations[currentLang][page];
  let html = `<h2>${t.title}</h2><p>${t.desc}</p>`;
  if(page === 'shop') {
    html += `<div class="shop-banner" style="background:url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=900&q=80') center/cover;height:180px;border-radius:8px;"></div>
      <div class="shop-profile">
        <div class="shop-avatar"><img src="https://i.imgur.com/0y0y0y0.png" alt="Shop Avatar"></div>
        <div><h3>ABC Shop</h3><p>â­â­â­â­â­ (4.9/5)</p></div>
      </div>
      <div class="shop-products" style="display:flex;gap:20px;margin:30px 0;flex-wrap:wrap;">`;
    demoProducts.forEach((p, idx) => {
      html += `<div class='product-card' onclick='showProductDetail(${idx})' style='cursor:pointer;'>
        <img src='${p.img}' alt='${p.name}'>
        <h4>${p.name}</h4>
        <div class='price'>${p.price.toLocaleString()}â‚«</div>
        <div class='status${p.status !== "Äang bÃ¡n" ? " soldout" : ""}'>${p.status}</div>
        <button onclick='event.stopPropagation();addToCart(${idx})' ${p.status!=="Äang bÃ¡n"?"disabled":''}>Mua ngay</button>
      </div>`;
    });
    html += `</div>`;
  }
  if(page === 'register') {
    html += `<form class="shop-register-form">
      <label>TÃªn Shop <input type="text" placeholder="Nháº­p tÃªn shop"></label><br>
      <label>MÃ´ táº£ <textarea placeholder="MÃ´ táº£ shop"></textarea></label><br>
      <label>Logo <input type="file"></label><br>
      <label>Loáº¡i hÃ ng hÃ³a <input type="text" placeholder="VÃ­ dá»¥: Thá»i trang, Äiá»‡n tá»­..."></label><br>
      <button type="submit">ÄÄƒng kÃ½</button>
    </form>`;
  }
  if(page === 'products') {
    let tab = window.productTab || 'category';
    html += `<div style='display:flex;gap:12px;margin-bottom:18px;'>
      <button class='product-tab-btn' onclick='switchProductTab("category")' ${tab==='category'?'style="background:#00fff7;color:#18122B;"':''}>Danh má»¥c sáº£n pháº©m</button>
      <button class='product-tab-btn' onclick='switchProductTab("product")' ${tab==='product'?'style="background:#00fff7;color:#18122B;"':''}>Sáº£n pháº©m</button>
    </div>`;
    if(tab==='category') {
      html += `<form onsubmit='addCategory(event)' style='margin-bottom:14px;display:flex;gap:8px;align-items:center;'><input id='catName' type='text' placeholder='TÃªn danh má»¥c má»›i' style='padding:7px 12px;border-radius:6px;border:2px solid #ff00cc;font-size:1rem;'><button type='submit' style='background:#00fff7;color:#18122B;font-weight:700;border:none;padding:7px 18px;border-radius:6px;cursor:pointer;'>+ ThÃªm danh má»¥c</button></form>`;
      html += `<table style='width:100%;border-collapse:collapse;margin-top:10px;'>
        <thead><tr style='background:#e3eafc;'><th>TÃªn danh má»¥c</th><th>Sá»‘ sáº£n pháº©m</th><th>HÃ nh Ä‘á»™ng</th></tr></thead><tbody>`;
      demoCategories.forEach((c, idx) => {
        html += `<tr style='border-bottom:1px solid #eee;'>
          <td>${window.editCatIdx===idx?`<input id='editCatInput' value='${c.name}' style='padding:4px 8px;border-radius:4px;border:1.5px solid #00fff7;font-size:1rem;'>`:c.name}</td>
          <td>${c.count}</td>
          <td>
            ${window.editCatIdx===idx?`<button onclick='saveEditCat(${idx})' style='background:#00fff7;color:#18122B;border:none;padding:4px 10px;border-radius:3px;cursor:pointer;'>LÆ°u</button> <button onclick='cancelEditCat()' style='background:#e53935;color:#fff;border:none;padding:4px 10px;border-radius:3px;cursor:pointer;'>Huá»·</button>`:
            `<button onclick='editCat(${idx})' style='background:#ffb300;color:#fff;border:none;padding:4px 10px;border-radius:3px;cursor:pointer;'>Sá»­a</button> <button onclick='deleteCat(${idx})' style='background:#e53935;color:#fff;border:none;padding:4px 10px;border-radius:3px;cursor:pointer;'>XoÃ¡</button>`}
          </td>
        </tr>`;
      });
      html += `</tbody></table>`;
    } else {
      html += `<form onsubmit='addProduct(event)' style='margin-bottom:14px;display:flex;gap:8px;flex-wrap:wrap;align-items:center;'><input id='prodName' type='text' placeholder='TÃªn sáº£n pháº©m' style='padding:7px 12px;border-radius:6px;border:2px solid #ff00cc;font-size:1rem;'><input id='prodImg' type='text' placeholder='Link áº£nh' style='padding:7px 12px;border-radius:6px;border:2px solid #ff00cc;font-size:1rem;width:180px;'><input id='prodPrice' type='number' placeholder='GiÃ¡' style='padding:7px 12px;border-radius:6px;border:2px solid #ff00cc;font-size:1rem;width:100px;'><select id='prodCat' style='padding:7px 12px;border-radius:6px;border:2px solid #ff00cc;font-size:1rem;'><option value=''>Chá»n danh má»¥c</option>${demoCategories.map(c=>`<option value='${c.name}'>${c.name}</option>`)}</select><select id='prodStatus' style='padding:7px 12px;border-radius:6px;border:2px solid #ff00cc;font-size:1rem;'><option>Äang bÃ¡n</option><option>Háº¿t hÃ ng</option></select><button type='submit' style='background:#00fff7;color:#18122B;font-weight:700;border:none;padding:7px 18px;border-radius:6px;cursor:pointer;'>+ ThÃªm sáº£n pháº©m</button></form>`;
      html += `<table style='width:100%;border-collapse:collapse;margin-top:10px;'>
        <thead><tr style='background:#e3eafc;'><th>áº¢nh</th><th>TÃªn sáº£n pháº©m</th><th>GiÃ¡</th><th>Danh má»¥c</th><th>Tráº¡ng thÃ¡i</th><th>HÃ nh Ä‘á»™ng</th></tr></thead><tbody>`;
        demoProducts.forEach((p, idx) => {
          html += `<tr style='border-bottom:1px solid #eee;'>
            <td><img src='${p.img}' alt='' style='width:60px;height:40px;object-fit:cover;border-radius:4px;'></td>
            <td>${window.editProdIdx===idx?`<input id='editProdName' value='${p.name}' style='padding:4px 8px;border-radius:4px;border:1.5px solid #00fff7;font-size:1rem;width:120px;'>`:p.name}</td>
            <td>${window.editProdIdx===idx?`<input id='editProdPrice' type='number' value='${p.price}' style='padding:4px 8px;border-radius:4px;border:1.5px solid #00fff7;font-size:1rem;width:80px;'>`:p.price.toLocaleString()+"â‚«"}</td>
            <td>${window.editProdIdx===idx?`<select id='editProdCat' style='padding:4px 8px;border-radius:4px;border:1.5px solid #00fff7;font-size:1rem;'>${demoCategories.map(c=>`<option value='${c.name}' ${c.name===p.category?'selected':''}>${c.name}</option>`)}</select>`:p.category||''}</td>
            <td>${window.editProdIdx===idx?`<select id='editProdStatus' style='padding:4px 8px;border-radius:4px;border:1.5px solid #00fff7;font-size:1rem;'><option ${p.status==='Äang bÃ¡n'?'selected':''}>Äang bÃ¡n</option><option ${p.status==='Háº¿t hÃ ng'?'selected':''}>Háº¿t hÃ ng</option></select>`:p.status}</td>
            <td>
              ${window.editProdIdx===idx?`<button onclick='saveEditProd(${idx})' style='background:#00fff7;color:#18122B;border:none;padding:4px 10px;border-radius:3px;cursor:pointer;'>LÆ°u</button> <button onclick='cancelEditProd()' style='background:#e53935;color:#fff;border:none;padding:4px 10px;border-radius:3px;cursor:pointer;'>Huá»·</button>`:
              `<button onclick='editProd(${idx})' style='background:#ffb300;color:#fff;border:none;padding:4px 10px;border-radius:3px;cursor:pointer;'>Sá»­a</button> <button onclick='deleteProd(${idx})' style='background:#e53935;color:#fff;border:none;padding:4px 10px;border-radius:3px;cursor:pointer;'>XoÃ¡</button>`}
            </td>
          </tr>`;
        });
        html += `</tbody></table>`;
    }
  }
  if(page === 'cart') {
    if(demoOrders.length === 0) {
      html += `<div class='cart-demo'><p>KhÃ´ng cÃ³ Ä‘Æ¡n hÃ ng nÃ o.</p></div>`;
    } else {
      html += `<table class='order-table'>
        <thead><tr><th>MÃ£ Ä‘Æ¡n</th><th>KhÃ¡ch hÃ ng</th><th>Sáº£n pháº©m</th><th>Tá»•ng tiá»n</th><th>Tráº¡ng thÃ¡i</th><th>NgÃ y</th></tr></thead><tbody>`;
      demoOrders.forEach(order => {
        let statusClass = order.status === 'ÄÃ£ thanh toÃ¡n' ? 'status-paid' : (order.status === 'Chá» thanh toÃ¡n' ? 'status-pending' : 'status-cancel');
        let statusIcon = order.status === 'ÄÃ£ thanh toÃ¡n' ? 'âœ”ï¸' : (order.status === 'Chá» thanh toÃ¡n' ? 'â³' : 'âŒ');
        html += `<tr onclick='showOrderDetail(${order.id})'>
          <td>#${order.id}</td>
          <td>${order.customer}</td>
          <td>${order.items.map(i=>demoProducts[i].name).join(', ')}</td>
          <td>${order.total.toLocaleString()}â‚«</td>
          <td class='${statusClass}'>${statusIcon} ${order.status}</td>
          <td>${order.date}</td>
        </tr>`;
      });
      html += `</tbody></table>`;
      html += `<button class='checkout-btn' onclick='showCheckoutPopup()'>Thanh toÃ¡n</button>`;
    }
  }
  if(page === 'ai') {
    html += `<div class='ai-analyze-box' style='margin-top:24px;'>
      <h3 style='font-family:Orbitron,Arial,sans-serif;font-size:1.3rem;color:#00fff7;text-shadow:0 0 8px #ff00cc;'>Chá»n chá»©c nÄƒng AI ná»•i báº­t</h3>
      <div style='display:flex;gap:14px;flex-wrap:wrap;margin-bottom:18px;'>
        <button class='ai-btn' onclick='renderAIResult("chatbot")'>ğŸ›ï¸ TÆ° váº¥n mua hÃ ng thÃ´ng minh</button>
        <button class='ai-btn' onclick='renderAIResult("search")'>ğŸ§  TÃ¬m kiáº¿m sáº£n pháº©m tá»± nhiÃªn</button>
        <button class='ai-btn' onclick='renderAIResult("personalize")'>ğŸ¯ CÃ¡ nhÃ¢n hÃ³a tráº£i nghiá»‡m</button>
        <button class='ai-btn' onclick='renderAIResult("content")'>ğŸ“ Táº¡o ná»™i dung tá»± Ä‘á»™ng</button>
        <button class='ai-btn' onclick='renderAIResult("vision")'>ğŸ“¸ Xá»­ lÃ½ hÃ¬nh áº£nh</button>
        <button class='ai-btn' onclick='renderAIResult("translate")'>ğŸ’¬ Dá»‹ch tá»± Ä‘á»™ng & Ä‘a ngÃ´n ngá»¯</button>
        <button class='ai-btn' onclick='renderAIResult("operation")'>ğŸ“¦ Tá»‘i Æ°u váº­n hÃ nh & quáº£n lÃ½</button>
      </div>
      <div id='ai-result-box'></div>
    </div>`;
  }
  if(page === 'statistic') {
    const totalOrders = demoOrders.length;
    const soldProducts = demoOrders.reduce((sum, o) => sum + o.items.length, 0);
    const totalIncome = demoOrders.filter(o=>o.status==="ÄÃ£ thanh toÃ¡n").reduce((sum,o)=>sum+o.total,0);
    const customers = [...new Set(demoOrders.map(o=>o.customer))];
    const productCount = {};
    demoOrders.forEach(o=>o.items.forEach(i=>{productCount[i]=(productCount[i]||0)+1}));
    const bestSellers = Object.entries(productCount).sort((a,b)=>b[1]-a[1]).slice(0,3);
    html += `
    <div class='statistic-box'>
      <div class='statistic-item'><span class='icon'>ğŸ“¦</span><div><div class='value'>${totalOrders}</div><div class='label'>Tá»•ng sá»‘ Ä‘Æ¡n</div></div></div>
      <div class='statistic-item'><span class='icon'>ğŸ’°</span><div><div class='value'>${totalIncome.toLocaleString()}â‚«</div><div class='label'>Tá»•ng doanh thu</div></div></div>
      <div class='statistic-item'><span class='icon'>ğŸ›’</span><div><div class='value'>${soldProducts}</div><div class='label'>Sáº£n pháº©m Ä‘Ã£ bÃ¡n</div></div></div>
    </div>
    <div class='statistic-box' style='flex-direction:column;gap:18px;'>
      <div><h3 style='margin-bottom:10px;'>Thá»‘ng kÃª ngÆ°á»i dÃ¹ng</h3><div class='customer-list'>`;
    customers.forEach(c => {
      html += `<div class='customer-card'><span class='icon'>ğŸ‘¤</span><b>${c}</b></div>`;
    });
    html += `</div></div>
      <div><h3 style='margin-bottom:10px;margin-top:18px;'>Thá»‘ng kÃª sáº£n pháº©m bÃ¡n cháº¡y</h3><div class='bestseller-list'>`;
    bestSellers.forEach(([i,c]) => {
      html += `<div class='bestseller-card'><span class='icon'>ğŸ”¥</span><b>${demoProducts[i].name}</b><span>ÄÃ£ bÃ¡n: ${c}</span></div>`;
    });
    html += `</div></div>
    </div>`;
  }
  if(page === 'fbpost') {
    html += `<div class='gemini-content-box'>
      <h3 style='font-family:Orbitron,Arial,sans-serif;font-size:1.3rem;color:#00fff7;text-shadow:0 0 8px #ff00cc;'>ğŸ§  Gá»£i Ã½ ná»™i dung tá»± Ä‘á»™ng tá»« Gemini</h3>
      <form id='gemini-form' style='margin:18px 0 12px 0;display:flex;flex-wrap:wrap;gap:14px;align-items:flex-end;'>
        <div style='flex:1 1 220px;min-width:180px;'><label>TÃªn sáº£n pháº©m<br><input id='gsp-name' type='text' placeholder='Ão thun ná»¯ siÃªu má»m' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;'></label></div>
        <div style='flex:1 1 220px;min-width:180px;'><label>MÃ´ táº£ ná»•i báº­t<br><input id='gsp-desc' type='text' placeholder='Váº£i má»‹n, co giÃ£n, trendy...' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;'></label></div>
        <div style='flex:1 1 120px;min-width:100px;'><label>GiÃ¡<br><input id='gsp-price' type='text' placeholder='199.000Ä‘' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;'></label></div>
        <div style='flex:1 1 220px;min-width:180px;'><label>Link áº£nh sáº£n pháº©m<br><input id='gsp-img' type='text' placeholder='https://...' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;'></label></div>
        <div style='flex:1 1 220px;min-width:180px;'><label>Link sáº£n pháº©m<br><input id='gsp-link' type='text' placeholder='https://...' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;'></label></div>
        <div style='flex:1 1 220px;min-width:180px;'><label>NÆ¡i Ä‘Äƒng<br>
          <select id='gsp-place' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;' onchange='toggleGroupInput()'>
            <option value='personal'>TÃ i khoáº£n cÃ¡ nhÃ¢n</option>
            <option value='fanpage'>Fanpage</option>
            <option value='group'>NhÃ³m Facebook</option>
            <option value='multi-group'>Nhiá»u nhÃ³m</option>
          </select>
        </label></div>
        <div id='group-input-box' style='display:none;flex:1 1 220px;min-width:180px;'><label>Nháº­p ID nhÃ³m (cÃ¡ch nhau dáº¥u pháº©y)<br><input id='gsp-groups' type='text' placeholder='group1,group2,...' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;'></label></div>
        <div style='flex:1 1 180px;min-width:140px;'><label>Cháº¿ Ä‘á»™ Ä‘Äƒng<br>
          <select id='gsp-mode' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;' onchange='toggleScheduleInput()'>
            <option value='now'>ÄÄƒng ngay</option>
            <option value='schedule'>LÃªn lá»‹ch</option>
          </select>
        </label></div>
        <div id='schedule-input-box' style='display:none;flex:1 1 220px;min-width:180px;'><label>NgÃ y giá» Ä‘Äƒng<br><input id='gsp-datetime' type='datetime-local' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;'></label><br><label>Láº·p láº¡i Ä‘á»‹nh ká»³<br><select id='gsp-repeat' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;'><option value='none'>KhÃ´ng láº·p</option><option value='daily'>HÃ ng ngÃ y</option><option value='weekly'>HÃ ng tuáº§n</option></select></label></div>
        <button type='submit' style='background:#00fff7;color:#18122B;font-weight:700;border:none;padding:10px 28px;border-radius:8px;cursor:pointer;font-size:1.1rem;flex:1 1 100px;min-width:120px;'>Táº¡o ná»™i dung</button>
      </form>
      <div id='gemini-output-box'></div>
      <div class='fb-guide' style='margin-top:24px;background:#18122B;padding:16px 18px;border-radius:10px;color:#ffe53b;'>
        <b>HÆ°á»›ng dáº«n Ä‘Äƒng Facebook:</b> <br>
        1. Nháº¥n <b>Sao chÃ©p</b> hoáº·c <b>ÄÄƒng tá»± Ä‘á»™ng</b> ná»™i dung gá»£i Ã½ bÃªn dÆ°á»›i.<br>
        2. Náº¿u Ä‘Äƒng tá»± Ä‘á»™ng, báº¡n cáº§n xÃ¡c thá»±c Facebook vÃ  cáº¥p quyá»n.<br>
        3. CÃ³ thá»ƒ chá»n Ä‘Äƒng lÃªn nhiá»u nhÃ³m, fanpage, lÃªn lá»‹ch Ä‘á»‹nh ká»³.<br>
        <span style='color:#00fff7;font-size:0.98em;'>* Äá»ƒ tá»± Ä‘á»™ng Ä‘Äƒng cáº§n token Fanpage, quyá»n pages_manage_posts, xÃ¡c thá»±c OAuth.</span>
      </div>
    </div>`;
  }
  document.getElementById('main-content').innerHTML = html;
}

function addToCart(idx) {
  cart.push(idx);
  currentPage = 'cart';
  renderPage('cart');
}

// HÃ m xem chi tiáº¿t Ä‘Æ¡n hÃ ng
function showOrderDetail(orderId) {
  const order = demoOrders.find(o=>o.id===orderId);
  if(!order) return;
  let html = `<div class='order-detail'><h2>Chi tiáº¿t Ä‘Æ¡n hÃ ng #${order.id}</h2>`;
  html += `<div><b>KhÃ¡ch hÃ ng:</b> ${order.customer}</div>`;
  html += `<div><b>NgÃ y Ä‘áº·t:</b> ${order.date}</div>`;
  html += `<div><b>Tráº¡ng thÃ¡i:</b> ${order.status === 'ÄÃ£ thanh toÃ¡n' ? 'âœ”ï¸' : (order.status === 'Chá» thanh toÃ¡n' ? 'â³' : 'âŒ')} <span class='${order.status === 'ÄÃ£ thanh toÃ¡n' ? 'status-paid' : (order.status === 'Chá» thanh toÃ¡n' ? 'status-pending' : 'status-cancel')}'>${order.status}</span></div>`;
  html += `<div><b>Tá»•ng tiá»n:</b> ${order.total.toLocaleString()}â‚«</div>`;
  html += `<div><b>Sáº£n pháº©m:</b><ul>`;
  order.items.forEach(i=>{
    const p = demoProducts[i];
    html += `<li>${p.name} - ${p.price.toLocaleString()}â‚«</li>`;
  });
  html += `</ul></div>`;
  html += `<button onclick="navigate('cart')">Quay láº¡i danh sÃ¡ch Ä‘Æ¡n</button></div>`;
  document.getElementById('main-content').innerHTML = html;
}

// Khá»Ÿi táº¡o trang Ä‘áº§u tiÃªn
document.addEventListener('DOMContentLoaded', () => {
  renderPage(currentPage);
  const fbBtn = document.getElementById('fb-post-btn');
  if(fbBtn) fbBtn.onclick = function(e) {
    e.preventDefault();
    navigate('fbpost');
  };
  const chatBtn = document.getElementById('chatbot-btn');
  if(chatBtn) chatBtn.onclick = function() {
    showChatbotPopup();
  };
  document.body.addEventListener('submit', function(e) {
    if(e.target && e.target.id==='gemini-form') {
      e.preventDefault();
      const name = document.getElementById('gsp-name').value.trim()||'Ão thun ná»¯ siÃªu má»m';
      const desc = document.getElementById('gsp-desc').value.trim()||'Váº£i má»‹n, co giÃ£n, trendy';
      const price = document.getElementById('gsp-price').value.trim()||'199.000Ä‘';
      const img = document.getElementById('gsp-img').value.trim();
      const link = document.getElementById('gsp-link').value.trim();
      const place = document.getElementById('gsp-place').value;
      const groups = (document.getElementById('gsp-groups')||{}).value||'';
      const mode = document.getElementById('gsp-mode').value;
      const datetime = (document.getElementById('gsp-datetime')||{}).value||'';
      const repeat = (document.getElementById('gsp-repeat')||{}).value||'none';
      const hashtags = '#ThoiTrangNu #SaleHe #AoThunDep';
      let content = `ğŸŒŸ ${name.toUpperCase()} ğŸŒŸ\n${desc}\nâœ… Co giÃ£n thoáº£i mÃ¡i\nâœ… Dá»… phá»‘i Ä‘á»“\nâœ… MÃ u sáº¯c trendy`;
      if(link) content += `\nğŸ‘‰ Äáº·t hÃ ng ngay káº»o háº¿t: ${link}`;
      if(price) content += `\nGiÃ¡ chá»‰ ${price}!`;
      content += `\n${hashtags}`;
      let imgHtml = img?`<img src='${img}' alt='' style='max-width:100%;border-radius:8px;margin:10px 0;'>`:'';
      let where = place==='personal'?'TÃ i khoáº£n cÃ¡ nhÃ¢n':(place==='fanpage'?'Fanpage':(place==='group'?'NhÃ³m':'Nhiá»u nhÃ³m'));
      let schedule = mode==='now'?'<b>ÄÄƒng ngay</b>':`<b>LÃªn lá»‹ch:</b> ${datetime?datetime:'(chÆ°a chá»n)'}${repeat!=='none'?` - Láº·p: ${repeat==='daily'?'HÃ ng ngÃ y':(repeat==='weekly'?'HÃ ng tuáº§n':'')}`:''}`;
      let groupInfo = (place==='group'||place==='multi-group')?`<div><b>NhÃ³m:</b> ${groups||'(chÆ°a nháº­p)'}</div>`:'';
      document.getElementById('gemini-output-box').innerHTML = `<div class='gemini-output'><div class='gemini-output-header'><span>Output AI gá»£i Ã½:</span> <button onclick='copyGeminiContent()' style='background:#00fff7;color:#18122B;font-weight:700;border:none;padding:6px 18px;border-radius:7px;cursor:pointer;'>Sao chÃ©p</button> <button onclick='autoPostDemo()' style='background:#ff00cc;color:#fff;font-weight:700;border:none;padding:6px 18px;border-radius:7px;cursor:pointer;margin-left:8px;'>ÄÄƒng tá»± Ä‘á»™ng</button></div>${imgHtml}<pre id='gemini-content' style='background:#232526;color:#ffe53b;padding:16px 14px;border-radius:8px;font-size:1.08em;margin:0 0 8px 0;white-space:pre-line;'>${content}</pre><div style='margin-top:8px;'><b>NÆ¡i Ä‘Äƒng:</b> ${where} ${groupInfo} | <b>Cháº¿ Ä‘á»™:</b> ${schedule}</div></div>`;
    }
    if(e.target && e.target.id==='chatbot-form') {
      e.preventDefault();
      const name = document.getElementById('chatbot-name').value.trim()||'KhÃ¡ch';
      const msg = document.getElementById('chatbot-msg').value.trim();
      if(!msg) return alert('Vui lÃ²ng nháº­p ná»™i dung!');
      const chatBox = document.getElementById('chatbot-chatbox');
      chatBox.innerHTML += `<div class='chatbot-user'><b>${name}:</b> ${msg}</div>`;
      setTimeout(()=>{
        chatBox.innerHTML += `<div class='chatbot-bot'><b>Bot:</b> Cáº£m Æ¡n báº¡n Ä‘Ã£ liÃªn há»‡! ChÃºng tÃ´i sáº½ pháº£n há»“i sá»›m nháº¥t. (Demo tráº£ lá»i tá»± Ä‘á»™ng)</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
      }, 600);
      document.getElementById('chatbot-msg').value = '';
      chatBox.scrollTop = chatBox.scrollHeight;
    }
  });
});

window.copyGeminiContent = function() {
  const text = document.getElementById('gemini-content').innerText;
  navigator.clipboard.writeText(text);
  alert('ÄÃ£ sao chÃ©p ná»™i dung!');
}

window.autoPostDemo = function() {
  alert('Demo: Gá»i Facebook API Ä‘á»ƒ Ä‘Äƒng bÃ i tá»± Ä‘á»™ng.\nBáº¡n cáº§n xÃ¡c thá»±c vÃ  cáº¥p quyá»n cho á»©ng dá»¥ng!');
}

window.renderAIResult = function(type) {
  let html = '';
  if(type==="chatbot") {
    html = `<div class='ai-result'><h4>ğŸ›ï¸ TÆ° váº¥n mua hÃ ng thÃ´ng minh (AI Chatbot)</h4><p>VÃ­ dá»¥: <i>"TÃ´i cáº§n quÃ  sinh nháº­t cho ná»¯, giÃ¡ dÆ°á»›i 500k"</i></p><div class='ai-demo-bot'><b>Gá»£i Ã½:</b> <span>Son mÃ´i 450k, NÆ°á»›c hoa mini 399k, VÃ²ng tay báº¡c 320k</span><br><b>Há»i vá» Ä‘á»•i tráº£:</b> <span>"Sáº£n pháº©m Ä‘Æ°á»£c Ä‘á»•i trong 7 ngÃ y náº¿u cÃ²n nguyÃªn tem."</span></div></div>`;
  } else if(type==="search") {
    html = `<div class='ai-result'><h4>ğŸ§  TÃ¬m kiáº¿m sáº£n pháº©m báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn</h4><p>VÃ­ dá»¥: <i>"TÃ´i muá»‘n má»™t Ä‘Ã´i giÃ y thá»ƒ thao mÃ u tráº¯ng, nháº¹ vÃ  khÃ´ng tháº¥m nÆ°á»›c"</i></p><div class='ai-demo-bot'><b>Káº¿t quáº£:</b> <span>GiÃ y Sneaker Tráº¯ng UltraLight - 499k</span></div></div>`;
  } else if(type==="personalize") {
    html = `<div class='ai-result'><h4>ğŸ¯ CÃ¡ nhÃ¢n hÃ³a tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng</h4><p>AI phÃ¢n tÃ­ch hÃ nh vi, gá»£i Ã½ sáº£n pháº©m liÃªn quan, tá»± Ä‘á»™ng thay Ä‘á»•i banner, sáº£n pháº©m ná»•i báº­t theo tá»«ng ngÆ°á»i dÃ¹ng.</p><div class='ai-demo-bot'><b>Gá»£i Ã½ cho báº¡n:</b> <span>Ão thun nam basic, Tai nghe Bluetooth, Äá»“ng há»“ thÃ´ng minh</span></div></div>`;
  } else if(type==="content") {
    html = `<div class='ai-result'><h4>ğŸ“ Táº¡o ná»™i dung tá»± Ä‘á»™ng</h4><p>AI táº¡o mÃ´ táº£ sáº£n pháº©m háº¥p dáº«n, bÃ i viáº¿t blog/SEO, email marketing, tiÃªu Ä‘á» khuyáº¿n mÃ£i.</p><div class='ai-demo-bot'><b>MÃ´ táº£ sáº£n pháº©m:</b> <span>"Ão thun cotton thoÃ¡ng mÃ¡t, thiáº¿t káº¿ tráº» trung, phÃ¹ há»£p má»i hoáº¡t Ä‘á»™ng."</span></div></div>`;
  } else if(type==="vision") {
    html = `<div class='ai-result'><h4>ğŸ“¸ Hiá»ƒu & xá»­ lÃ½ hÃ¬nh áº£nh (Gemini Vision)</h4><p>Nháº­n diá»‡n sáº£n pháº©m trong áº£nh, tÃ¬m sáº£n pháº©m tÆ°Æ¡ng tá»±, kiá»ƒm duyá»‡t áº£nh bÃ¬nh luáº­n.</p><div class='ai-demo-bot'><b>áº¢nh táº£i lÃªn:</b> <img src='https://images.unsplash.com/photo-1519741497674-611481863552?auto=format&fit=crop&w=120&q=80' style='height:40px;border-radius:6px;vertical-align:middle;'> <span>AI nháº­n diá»‡n: GiÃ y sneaker tráº¯ng</span></div></div>`;
  } else if(type==="translate") {
    html = `<div class='ai-result'><h4>ğŸ’¬ Dá»‹ch tá»± Ä‘á»™ng & há»— trá»£ Ä‘a ngÃ´n ngá»¯</h4><p>Dá»‹ch ná»™i dung sáº£n pháº©m, tráº£ lá»i khÃ¡ch quá»‘c táº¿ báº±ng ngÃ´n ngá»¯ cá»§a há».</p><div class='ai-demo-bot'><b>VÃ­ dá»¥:</b> <span>"Ão thun nam basic" â†’ <i>"Basic men's T-shirt" (EN)</i> / <i>"à»€àºªàº·à»‰àº­àºàº·àº”àºœàº¹à»‰àºŠàº²àº" (Lao)</i></span></div></div>`;
  } else if(type==="operation") {
    html = `<div class='ai-result'><h4>ğŸ“¦ Tá»‘i Æ°u quy trÃ¬nh váº­n hÃ nh & quáº£n lÃ½</h4><p>TrÃ­ch xuáº¥t dá»¯ liá»‡u tá»« hÃ³a Ä‘Æ¡n, Ä‘Æ¡n hÃ ng, email khÃ¡ch, tÃ³m táº¯t pháº£n há»“i, tá»± Ä‘á»™ng táº¡o bÃ¡o cÃ¡o sáº£n pháº©m bÃ¡n cháº¡y.</p><div class='ai-demo-bot'><b>BÃ¡o cÃ¡o nhanh:</b> <span>Tuáº§n nÃ y: 120 Ä‘Æ¡n, 3 sáº£n pháº©m bÃ¡n cháº¡y nháº¥t: Ão thun, GiÃ y sneaker, Tai nghe</span></div></div>`;
  }
  document.getElementById('ai-result-box').innerHTML = html;
}

window.renderAIResultLocation = function() {
  const val = document.getElementById('ai-location').value;
  let result = '';
  if(val==='hanoi') result = 'HÃ  Ná»™i: Khu vá»±c Ä‘Ã´ng dÃ¢n, sá»©c mua lá»›n, phÃ¹ há»£p kinh doanh thá»i trang, Ä‘á»“ gia dá»¥ng, Ä‘á»“ Äƒn nhanh.';
  if(val==='hochiminh') result = 'Há»“ ChÃ­ Minh: Trung tÃ¢m kinh táº¿, khÃ¡ch hÃ ng tráº», thÃ­ch há»£p sáº£n pháº©m cÃ´ng nghá»‡, phá»¥ kiá»‡n, dá»‹ch vá»¥ nhanh.';
  if(val==='danang') result = 'ÄÃ  Náºµng: Du lá»‹ch phÃ¡t triá»ƒn, nÃªn kinh doanh Ä‘áº·c sáº£n, quÃ  lÆ°u niá»‡m, dá»‹ch vá»¥ du lá»‹ch.';
  if(val==='vientiane') result = 'ViÃªng ChÄƒn: Thá»‹ trÆ°á»ng má»›i ná»•i, nhu cáº§u hÃ ng tiÃªu dÃ¹ng, thá»i trang, Ä‘iá»‡n tá»­ tÄƒng.';
  if(val==='savannakhet') result = 'Savannakhet: Kinh doanh thá»±c pháº©m, hÃ ng tiÃªu dÃ¹ng, dá»‹ch vá»¥ váº­n chuyá»ƒn phÃ¹ há»£p.';
  document.getElementById('ai-location-result').innerHTML = `<p>${result}</p>`;
}

window.switchProductTab = function(tab) {
  window.productTab = tab;
  window.editCatIdx = undefined;
  window.editProdIdx = undefined;
  renderPage('products');
}

window.addCategory = function(e) {
  e.preventDefault();
  const name = document.getElementById('catName').value.trim();
  if(!name) return alert('Nháº­p tÃªn danh má»¥c!');
  if(demoCategories.some(c=>c.name.toLowerCase()===name.toLowerCase())) return alert('Danh má»¥c Ä‘Ã£ tá»“n táº¡i!');
  demoCategories.push({name,count:0});
  renderPage('products');
}

window.editCat = function(idx) {
  window.editCatIdx = idx;
  renderPage('products');
}

window.saveEditCat = function(idx) {
  const val = document.getElementById('editCatInput').value.trim();
  if(!val) return alert('TÃªn khÃ´ng Ä‘Æ°á»£c Ä‘á»ƒ trá»‘ng!');
  if(demoCategories.some((c,i)=>c.name.toLowerCase()===val.toLowerCase()&&i!==idx)) return alert('TrÃ¹ng tÃªn!');
  demoCategories[idx].name = val;
  // cáº­p nháº­t category cho sáº£n pháº©m
  demoProducts.forEach(p=>{if(p.category===demoCategories[idx].name)p.category=val;});
  window.editCatIdx = undefined;
  renderPage('products');
}

window.cancelEditCat = function() {
  window.editCatIdx = undefined;
  renderPage('products');
}

window.deleteCat = function(idx) {
  if(!confirm('XoÃ¡ danh má»¥c nÃ y?')) return;
  if(demoCategories[idx].count>0) return alert('Danh má»¥c cÃ²n sáº£n pháº©m!');
  demoCategories.splice(idx,1);
  renderPage('products');
}

window.addProduct = function(e) {
  e.preventDefault();
  const name = document.getElementById('prodName').value.trim();
  const img = document.getElementById('prodImg').value.trim();
  const price = +document.getElementById('prodPrice').value;
  const category = document.getElementById('prodCat').value;
  const status = document.getElementById('prodStatus').value;
  if(!name||!img||!price||!category) return alert('Äiá»n Ä‘á»§ thÃ´ng tin!');
  demoProducts.push({name,img,price,status,category});
  // tÄƒng count danh má»¥c
  const cat = demoCategories.find(c=>c.name===category); if(cat) cat.count++;
  renderPage('products');
}

window.editProd = function(idx) {
  window.editProdIdx = idx;
  renderPage('products');
}

window.saveEditProd = function(idx) {
  const name = document.getElementById('editProdName').value.trim();
  const price = +document.getElementById('editProdPrice').value;
  const category = document.getElementById('editProdCat').value;
  const status = document.getElementById('editProdStatus').value;
  if(!name||!price||!category) return alert('Äiá»n Ä‘á»§ thÃ´ng tin!');
  // cáº­p nháº­t count danh má»¥c náº¿u Ä‘á»•i
  const oldCat = demoProducts[idx].category;
  if(oldCat!==category){
    const oldC = demoCategories.find(c=>c.name===oldCat); if(oldC) oldC.count--;
    const newC = demoCategories.find(c=>c.name===category); if(newC) newC.count++;
  }
  demoProducts[idx].name = name;
  demoProducts[idx].price = price;
  demoProducts[idx].category = category;
  demoProducts[idx].status = status;
  window.editProdIdx = undefined;
  renderPage('products');
}

window.cancelEditProd = function() {
  window.editProdIdx = undefined;
  renderPage('products');
}

window.deleteProd = function(idx) {
  if(!confirm('XoÃ¡ sáº£n pháº©m nÃ y?')) return;
  // giáº£m count danh má»¥c
  const cat = demoCategories.find(c=>c.name===demoProducts[idx].category); if(cat) cat.count--;
  demoProducts.splice(idx,1);
  renderPage('products');
}

window.toggleGroupInput = function() {
  const val = document.getElementById('gsp-place').value;
  document.getElementById('group-input-box').style.display = (val==='group'||val==='multi-group')?'block':'none';
}

window.toggleScheduleInput = function() {
  const val = document.getElementById('gsp-mode').value;
  document.getElementById('schedule-input-box').style.display = (val==='schedule')?'block':'none';
}

function showChatbotPopup() {
  if(document.getElementById('chatbot-popup')) return;
  const popup = document.createElement('div');
  popup.id = 'chatbot-popup';
  popup.innerHTML = `<div class='chatbot-inner'><div class='chatbot-header' id='chatbot-header'><span>ğŸ’¬ Chatbot LiÃªn há»‡</span><button onclick='document.getElementById("chatbot-popup").remove()' style='background:none;border:none;color:#00fff7;font-size:1.5rem;cursor:pointer;margin-left:auto;'>Ã—</button></div><div class='chatbot-quick'><button onclick='chatbotQuick("ThÃ´ng tin shop")'>ThÃ´ng tin shop</button><button onclick='chatbotQuick("LiÃªn há»‡")'>LiÃªn há»‡</button><button onclick='chatbotQuick("Sáº£n pháº©m hot nháº¥t?")'>Há»i sáº£n pháº©m</button></div><div id='chatbot-chatbox' class='chatbot-chatbox'></div><form id='chatbot-form' style='display:flex;gap:8px;margin-top:10px;'><input id='chatbot-name' type='text' placeholder='TÃªn cá»§a báº¡n' style='flex:1 1 80px;padding:8px 10px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;'><input id='chatbot-msg' type='text' placeholder='Nháº­p ná»™i dung...' style='flex:2 1 120px;padding:8px 10px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;'><button type='submit' style='background:#00fff7;color:#18122B;font-weight:700;border:none;padding:8px 18px;border-radius:8px;cursor:pointer;'>Gá»­i</button></form></div>`;
  Object.assign(popup.style, {position:'fixed',bottom:'90px',right:'18px',zIndex:99999});
  document.body.appendChild(popup);
  // KÃ©o di chuyá»ƒn
  let isDrag=false, startX=0, startY=0, startLeft=0, startTop=0;
  const header = document.getElementById('chatbot-header');
  header.style.cursor = 'move';
  header.onmousedown = function(e) {
    isDrag = true;
    startX = e.clientX;
    startY = e.clientY;
    const rect = popup.getBoundingClientRect();
    startLeft = rect.left;
    startTop = rect.top;
    document.body.style.userSelect = 'none';
  };
  document.onmousemove = function(e) {
    if(isDrag) {
      let left = startLeft + (e.clientX - startX);
      let top = startTop + (e.clientY - startY);
      popup.style.left = left+'px';
      popup.style.top = top+'px';
      popup.style.right = 'auto';
      popup.style.bottom = 'auto';
    }
  };
  document.onmouseup = function() { isDrag=false; document.body.style.userSelect=''; };
}
window.chatbotQuick = function(msg) {
  const name = document.getElementById('chatbot-name').value.trim()||'KhÃ¡ch';
  const chatBox = document.getElementById('chatbot-chatbox');
  chatBox.innerHTML += `<div class='chatbot-user'><b>${name}:</b> ${msg}</div>`;
  setTimeout(()=>{
    let reply = 'Cáº£m Æ¡n báº¡n Ä‘Ã£ liÃªn há»‡!';
    if(msg.includes('shop')) reply = 'Shop ABC - ChuyÃªn thá»i trang, phá»¥ kiá»‡n, giao hÃ ng toÃ n quá»‘c.';
    if(msg.includes('LiÃªn há»‡')) reply = 'Báº¡n cÃ³ thá»ƒ gá»i 0123.456.789 hoáº·c inbox fanpage Ä‘á»ƒ Ä‘Æ°á»£c há»— trá»£.';
    if(msg.includes('Sáº£n pháº©m')) reply = 'Sáº£n pháº©m hot: Ão thun ná»¯ siÃªu má»m, GiÃ y sneaker tráº¯ng, Tai nghe Bluetooth.';
    chatBox.innerHTML += `<div class='chatbot-bot'><b>Bot:</b> ${reply}</div>`;
    chatBox.scrollTop = chatBox.scrollHeight;
  }, 600);
  chatBox.scrollTop = chatBox.scrollHeight;
}

window.showProductDetail = function(idx) {
  const p = demoProducts[idx];
  const popup = document.createElement('div');
  popup.className = 'product-detail-popup';
  popup.innerHTML = `<div class='product-detail-inner'><button onclick='this.closest(".product-detail-popup").remove()' style='position:absolute;top:10px;right:16px;background:none;border:none;color:#00fff7;font-size:1.6rem;cursor:pointer;'>Ã—</button><img src='${p.img}' alt='' style='width:100%;max-width:320px;border-radius:14px;box-shadow:0 2px 16px #00fff7cc;margin-bottom:16px;'><h3 style='color:#00fff7;font-family:Orbitron,sans-serif;font-size:1.25rem;'>${p.name}</h3><div class='price' style='font-size:1.15rem;margin-bottom:6px;'>${p.price.toLocaleString()}â‚«</div><div class='status${p.status!="Äang bÃ¡n"?" soldout":""}' style='margin-bottom:10px;'>${p.status}</div><div style='color:#ffe53b;font-size:1.08em;margin-bottom:12px;'>${p.desc||"KhÃ´ng cÃ³ mÃ´ táº£."}</div><button onclick='addToCart(${idx});this.closest(".product-detail-popup").remove()' style='background:#00fff7;color:#18122B;font-weight:700;border:none;padding:10px 28px;border-radius:8px;cursor:pointer;font-size:1.1rem;' ${p.status!=="Äang bÃ¡n"?"disabled":''}>Mua ngay</button></div>`;
  Object.assign(popup.style, {position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.45)',zIndex:9999,display:'flex',alignItems:'center',justifyContent:'center'});
  document.body.appendChild(popup);
}

window.showCheckoutPopup = function() {
  const popup = document.createElement('div');
  popup.className = 'checkout-popup';
  popup.innerHTML = `<div class='checkout-inner'><button onclick='this.closest(".checkout-popup").remove()' style='position:absolute;top:10px;right:16px;background:none;border:none;color:#00fff7;font-size:1.6rem;cursor:pointer;'>Ã—</button><h3 style='color:#00fff7;font-family:Orbitron,sans-serif;font-size:1.18rem;margin-bottom:10px;'>Thanh toÃ¡n Ä‘Æ¡n hÃ ng</h3><form id='checkout-form'><label>Há» tÃªn<br><input id='ck-name' type='text' required style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;margin-bottom:8px;'></label><label>Sá»‘ Ä‘iá»‡n thoáº¡i<br><input id='ck-phone' type='tel' required style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;margin-bottom:8px;'></label><label>Äá»‹a chá»‰ nháº­n hÃ ng<br><input id='ck-address' type='text' required style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;margin-bottom:8px;'></label><label>PhÆ°Æ¡ng thá»©c thanh toÃ¡n<br><select id='ck-method' style='padding:8px 14px;border-radius:7px;border:2px solid #ff00cc;font-size:1rem;width:100%;margin-bottom:12px;' onchange='toggleQRBox()'><option value='qr'>Chuyá»ƒn khoáº£n QR</option><option value='cod'>Ship COD</option></select></label><div id='qr-box' style='margin-bottom:12px;'><img src='https://img.vietqr.io/image/970422-123456789-compact2.png?amount=0&addInfo=ShopLao' alt='QR code' style='width:160px;display:block;margin:0 auto 6px auto;border-radius:10px;box-shadow:0 2px 12px #00fff7cc;'><div style='color:#ffe53b;font-size:0.98em;'>QuÃ©t mÃ£ QR Ä‘á»ƒ thanh toÃ¡n</div></div><button type='submit' style='background:#00fff7;color:#18122B;font-weight:700;border:none;padding:10px 28px;border-radius:8px;cursor:pointer;font-size:1.1rem;width:100%;margin-top:8px;'>XÃ¡c nháº­n thanh toÃ¡n</button></form></div>`;
  Object.assign(popup.style, {position:'fixed',top:0,left:0,right:0,bottom:0,background:'rgba(0,0,0,0.45)',zIndex:9999,display:'flex',alignItems:'center',justifyContent:'center'});
  document.body.appendChild(popup);
}

window.toggleQRBox = function() {
  const val = document.getElementById('ck-method').value;
  document.getElementById('qr-box').style.display = val==='qr'?'block':'none';
}

document.body.addEventListener('submit', function(e) {
  if(e.target && e.target.id==='checkout-form') {
    e.preventDefault();
    const name = document.getElementById('ck-name').value.trim();
    const phone = document.getElementById('ck-phone').value.trim();
    const address = document.getElementById('ck-address').value.trim();
    const method = document.getElementById('ck-method').value;
    if(method==='qr') {
      alert('Cáº£m Æ¡n báº¡n Ä‘Ã£ thanh toÃ¡n qua QR! ÄÆ¡n hÃ ng sáº½ Ä‘Æ°á»£c xá»­ lÃ½.');
    } else {
      alert('ÄÆ¡n hÃ ng sáº½ Ä‘Æ°á»£c giao vÃ  thu tiá»n táº­n nÆ¡i (COD).');
    }
    document.querySelector('.checkout-popup').remove();
  }
}); 